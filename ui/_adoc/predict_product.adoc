= RXN for Chemistry - Predict product 
:docinfo: shared
:icons: font
:showtitle!:
:nofooter:
:source-highlighter: rouge

link:index.html[icon:arrow-circle-left[2x]  Return to RXN for Chemistry Documentation]

[discrete]
== {doctitle}

This guide is a tutorial to learn how to use RXN for Chemistry to predict which forward reaction will occur from a set of given reagents.
////
NOTE: IBM, the IBM logo, and ibm.comÂ® are trademarks or registered trademarks of IBM Corporation, registered in many jurisdictions worldwide. Other product and service names might be trademarks of IBM or other companies. A current list of IBM trademarks is available here: https://www.ibm.com/legal/copyright-trademark[Copyright and Trademark Information].
////
.*Start Tutorial*
[%collapsible]
=======
---
IMPORTANT: An RXN for Chemistry account is required to complete this tutorial.

[NOTE]
====
* Number of steps in this tutorial: *24*
* Estimated time to complete this tutorial: *15 minutes*
====
---

.*Step 1:* Log into RXN for Chemistry
[%collapsible]
====
TIP: See our link:./quick_start.html[RXN for Chemistry Quick Start] for directions on logging into the RXN for Chemistry system.
====

.*Step 2:* From the Home screen click "Predict product"
[%collapsible]
====
image:./images/predict_product_s2.png[Screenshot of: Click "Predict forward reaction"]
====

.*Step 3:* Select "Add to pre-existing project" or "Add to a brand new project" 
[%collapsible]
====
If selecting *Add to pre-existing project* then use the dropdown labeled "Filter" to select the project.

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/2b4d8a5e-65d3-4e14-9b54-ec5ffa0fe668/ascreenshot.jpeg?tl_px=422,342&br_px=1497,943&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=502,370[Screenshot of: Click here.]
====

.*Step 4:* Click "Predict forward reaction"
[%collapsible]
====
image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/197c6330-4087-4bf2-b322-d120ca4ea137/ascreenshot.jpeg?tl_px=575,319&br_px=1650,920&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=502,265[Screenshot of: Click "Predict forward reaction"]
====

.*Step 5:* In the visual editor, click "Smiles string editor" at the top of the page
[%collapsible]
====
image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-06/4587690c-ef42-4c8f-9447-72bb02d3cf8d/ascreenshot.jpeg?tl_px=359,0&br_px=1219,480&force_format=png&width=860&wat_scale=76&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=402,-8[Screenshot of: Click "Smiles string editor"]
====

.*Step 6:* Copy and paste a SMILES string into the text box.
[%collapsible]
====
On this page you will paste a SMILES string representing the reactant molecules to use for the product prediction. Use the one shown below. 

========
We will use the SMILES string below for our starting materials. There are four organic molecules and a potassium counterion, separated by periods.

[literal]
CC(C)(C)OC(=O)N1CCCC1[B-](F)(F)F.CN(C)C=O.COC(=O)c1ccc(/C=C/S(=O)(=O)c2ccccc2)cc1.Cc1c(Br)cc2c(-c3ccccc3C(=O)O)c3cc(Br)c(=O)c(Br)c-3oc2c1Br.[K+]
========

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-06/bc8bdd76-4b07-4911-8f78-57c8da857b4e/ascreenshot.jpeg?tl_px=153,0&br_px=1012,480&force_format=png&width=860&wat_scale=76&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=402,138[Screenshot of: Click this field.]
====

.*Step 7:* Click "Validate string smiles" to validate the structure in the SMILES string
[%collapsible]
====
image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-06/a0fe68fc-6385-4263-b26c-0b1f2d31d6a5/ascreenshot.jpeg?tl_px=19,277&br_px=879,758&force_format=png&width=860&wat_scale=76&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=402,216[Screenshot of: Click "Validate string smiles"]
====

.*Step 8:* Click "Load in visual editor" to view a visual model of the molecules and ion
[%collapsible]
====
image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-06/fb98a000-8405-4795-b3fc-c7499bbb9edd/ascreenshot.jpeg?tl_px=439,277&br_px=1299,758&force_format=png&width=860&wat_scale=76&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=402,214[Screenshot of: Click "Load in visual editor"]
====

.*Step 9:* Click "Run forward reaction prediction" to start the process
[%collapsible]
====

image:./images/predict_product_s8.png[predict_product_s8.png]

====

.*Step 10:* Select the *2020-08-10* machine learning model then click "Run forward reaction prediction"
[%collapsible]
====

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/c50e8305-fa85-4de8-8b2b-d393ddf3fb7e/ascreenshot.jpeg?tl_px=629,342&br_px=1704,943&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=502,276[Screenshot of: Click "Run forward reaction prediction"]
====

.*Step 11:* After viewing your results, click "Generate more outcomes" to generate more potential products.
[%collapsible]
====

Results will be presented in a visual format as show below.  You also have the option of downloading the results as a SMILES string or a PDF file of the molecular models.

NOTE: The process of generating the first result shown below can take anywhere from a few seconds to a few minutes, depending upon the complexity of the reactions.

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/20649881-61af-42b1-ad50-0ff3734c6312/ascreenshot.jpeg?tl_px=844,0&br_px=1920,600&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=731,-7[Screenshot of: Click "Generate more outcomes"]
====

.*Step 12:* The newly predicted products may be viewed via the dropdown list labeled with the project name. 
[%collapsible]
====

NOTE: The process of generating the first result show below can take anywhere from a few seconds to a few minutes, depending upon the complexity of the reactions.

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/025a4667-9063-4ca5-8882-130eb26ca185/ascreenshot.jpeg?tl_px=0,0&br_px=1075,600&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=260,115[Screenshot of: Click here.]

====

.*Step 13:* After selecting a predicted reaction click the icon for *Predict reaction properties* in upper right
[%collapsible]
====
The icon for Predict reaction properties is shown below.

NOTE: The algorithms for predicting reaction properties take a representation of the reaction (Condensed Graph of Reaction, CGR) and use it as input to a graph-based convolutional neural network.  See this article for an example of this approach: https://pubs.acs.org/doi/10.1021/acs.jcim.1c00975#

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/9e75d63b-10ec-4eb2-b16d-d8728a988a71/ascreenshot.jpeg?tl_px=844,0&br_px=1920,600&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=710,51[Screenshot of: Click here.]
====

.*Step 14:* In the dialog box select "atom-mapping-2020" under "AI model" then click *Get prediction* 
[%collapsible]
====

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/8e86050f-97c4-4b4e-b3aa-02d5fb84c65f/ascreenshot.jpeg?tl_px=553,67&br_px=1628,668&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=502,265[Screenshot of: Click this dropdown.]
====

.*Step 15:* Click on the the dropdown to view results or *Download results* to download to CSV 
[%collapsible]
====

image:images/predict_product_s15.png[predict_product_s15.png]
====

.*Step 16:* Click on the TMAP icon as shown below 
[%collapsible]
====
This will take you to a visual TMAP showing your retrosynthesis results in the context of other chemical structures and properties. 

[NOTE]
========

*What is a TMAP?*

TMAP (TreeMAP) is a set of algorithms to help visualize high-dimensional data sets containing chemical structures. It provides the ability to visualize such data while preserving both global and local features with a sufficient level of detail to allow for human inspection and interpretation.

For more information on TMAP see the following:

* https://jcheminf.biomedcentral.com/articles/10.1186/s13321-020-0416-x[Journal of Cheminformatics paper on TMAP]
* http://tmap.gdb.tools/[Documentation for Python TMAP library]

========

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/805654ba-a2f1-43ba-986f-2fc347896d10/ascreenshot.jpeg?tl_px=844,0&br_px=1920,600&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=770,53[Screenshot of: Click this icon.]
====

.*Step 17:* After reading the TMAP guidance, click "Continue with TMAP"
[%collapsible]
====

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-10/8feddb2e-c133-4240-8ad2-50e15dc87c85/ascreenshot.jpeg?tl_px=305,203&br_px=1380,804&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=502,457[Screenshot of: Click "Continue with TMAP"]

====

.*Step 18:* Click on the +/- zoom icons to zoom in and out of TMAP
[%collapsible]
====

NOTE: The legend on the right hand side of the TMAP shows you the colors used to represent your reactions most closely related neighbors in the TMAP.

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-10/0a72ec90-a723-4b92-b40c-d988e2fc7caf/ascreenshot.jpeg?tl_px=109,203&br_px=1184,804&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=502,517[Screenshot of: Click this icon.]
====

.*Step 19:* Click on the "X" in the upper right of the screen to close the TMAP 
[%collapsible]
====
After you have finished exploring the TMAP close it to return to the reactions view.

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-10/f1613317-902f-480a-a8b8-b17bd50e7e10/ascreenshot.jpeg?tl_px=364,0&br_px=1440,600&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=1010,-8[Screenshot of: Click here.]
====

.*Step 20:* Click on the icon for "Similar reactions list" as shown below
[%collapsible]
====
The Similar reactions list will identify reactions in the RXN database that are similar to the predicted reaction.

Click the same icon again to close the Similar reactions list.

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/178a63d9-743b-4b7e-94fd-d1520469d03e/ascreenshot.jpeg?tl_px=844,0&br_px=1920,600&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=830,53[Screenshot of: Click this icon.]
====

.*Step 21:* Click on the icon for "Copy fingerprint" as shown below
[%collapsible]
====

The reaction fingerprint for the predicted product reaction will be copied to the clipboard of your browser. You may then paste it into a text document.

[NOTE]
========
A unique "fingerprint" for a chemical reaction can be computed and used as a means to compare molecules and reactions for similarity. 

For more information on fingerprints as used here see the following: link:https://www.nature.com/articles/s42256-020-00284-w.epdf?sharing_token=CGHu6tcqBiFmC1nRfnOrxNRgN0jAjWel9jnR3ZoTv0NiJSBmQfyOiLfbwen1TgEszNU5Xao_0Gs7D0u8tLUOJxaLAUc469WZKWG5K9wsqIe98dZOREVhQ33gqcr33AgNUjnp4cVXojp4aKe2xCbWtNaxOZtpOjBOsdX3O8yxVkI%3D[Mapping the space of chemical reactions using attention-based neural networks]
========
image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/c365b0bc-e304-47f8-b918-1535a4488a6e/ascreenshot.jpeg?tl_px=844,0&br_px=1920,600&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=892,53[Screenshot of: Click here.]

========
This is an example of a chemical reaction  fingerprint. It is the fingerprint of the example prediction used in this tutorial.

[literal]
[-1.6735221147537231,-1.8661422729492188,-1.81363844871521,-0.42113983631134033,0.8483024835586548,-1.4488575458526611,-0.3686295449733734,0.48501721024513245,-0.4201167821884155,0.7862669229507446,1.6044626235961914,1.9873979091644287,-0.6177471876144409,-1.3560351133346558,0.8070701360702515,1.600415825843811,2.0789148807525635,1.0853002071380615,-1.16912841796875,1.8132174015045166,-0.04413942992687225,-1.5996822118759155,1.5000373125076294,-2.158449172973633,-0.043316882103681564,0.6088337898254395,-2.3338332176208496,0.26505646109580994,-0.6696520447731018,0.18725325167179108,-1.8624275922775269,0.2769564390182495,-1.665277123451233,0.6663358807563782,0.9145832061767578,0.8559666275978088,-0.28232306241989136,2.012446403503418,0.7017057538032532,-0.20654496550559998,-0.9641878008842468,0.6031150817871094,2.5843288898468018,0.05475091561675072,0.16606159508228302,-0.7218376398086548,-1.1366875171661377,-0.1451134979724884,1.0618172883987427,-2.5014426708221436,-0.9198063015937805,-1.2385824918746948,-1.9134392738342285,1.3107930421829224,-0.4073719382286072,0.6758602261543274,-0.24437646567821503,0.23337365686893463,0.4276561439037323,-2.0148684978485107,0.15300783514976501,0.24463608860969543,1.647057294845581,1.000285267829895,-2.3709778785705566,-2.2312567234039307,-0.23227889835834503,-0.9871393442153931,-0.0332455113530159,1.4668725728988647,0.21972636878490448,0.40992364287376404,0.8064353466033936,-1.5371326208114624,1.3094781637191772,1.1358438730239868,1.990492343902588,0.583197295665741,1.4765615463256836,-1.9212021827697754,1.8876357078552246,-0.9314133524894714,0.9261294007301331,-0.9328246116638184,-2.023683547973633,0.5802607536315918,1.6187268495559692,-1.1474950313568115,-1.4451885223388672,-0.6014682054519653,2.982538938522339,-1.2691913843154907,2.520561695098877,0.3426623046398163,0.45115330815315247,-1.2578530311584473,0.9584701657295227,-0.4342820346355438,1.8066455125808716,-0.2416236251592636,-1.919986367225647,-0.4358331561088562,-0.22032895684242249,-0.48406532406806946,-1.5424023866653442,-0.5284754037857056,-0.41207802295684814,0.6387926340103149,1.5004230737686157,-0.46045300364494324,-0.295758455991745,-1.4000827074050903,2.247321367263794,-0.16716280579566956,0.35531893372535706,1.403519868850708,2.022871732711792,-0.9577924013137817,-1.4963902235031128,-0.6279836297035217,1.521104335784912,1.694411039352417,0.9639431834220886,0.817285418510437,-0.37822556495666504,-0.4834178686141968,-2.0221869945526123,0.25094929337501526,0.6673620343208313,-0.7312247157096863,-0.08003901690244675,-0.9209358096122742,-1.050477385520935,0.15671633183956146,-1.3165003061294556,0.49190762639045715,0.6970290541648865,-0.7401221990585327,-1.9508565664291382,-0.06427758187055588,-0.3380867838859558,-3.0102744102478027,0.1726202666759491,-0.7045319080352783,1.016224980354309,-1.933265209197998,0.49109789729118347,0.9653928875923157,-1.1889824867248535,-1.1172419786453247,-0.8418462872505188,2.8990540504455566,0.17563675343990326,0.3059397041797638,0.8853565454483032,2.375370740890503,-1.5038506984710693,1.3053393363952637,2.7178006172180176,0.025221142917871475,0.7661250829696655,0.8579445481300354,-1.7825069427490234,-0.061436738818883896,1.7058143615722656,-0.679970920085907,0.7506396174430847,-0.46935972571372986,0.52462238073349,-0.02844817191362381,-0.4783799350261688,1.4757037162780762,2.03218936920166,-1.2990103960037231,2.2932684421539307,0.7963569760322571,1.37050199508667,-1.4677737951278687,-1.2829804420471191,1.245859980583191,-1.6395522356033325,1.849403738975525,0.6918516159057617,-1.7216944694519043,1.243910312652588,2.095116376876831,0.857475996017456,-1.9396564960479736,2.579957962036133,0.9238468408584595,1.989099144935608,-1.0537619590759277,-2.0923664569854736,0.2938729524612427,1.5466368198394775,-1.5715738534927368,-1.1522927284240723,-4.446835041046143,-0.19612669944763184,0.7210275530815125,-2.6536903381347656,0.8428071141242981,0.6317269802093506,-0.5896157622337341,0.2165938764810562,-0.4859275817871094,-0.5935143232345581,-0.10690609365701675,0.09114240109920502,-0.7064465880393982,-1.164090871810913,-1.0682263374328613,1.7902114391326904,-0.6769233345985413,-0.04595673829317093,0.2578873336315155,-2.1300554275512695,-1.3884824514389038,-1.9772262573242188,0.41490432620048523,-2.239422559738159,-2.1128203868865967,-1.1498372554779053,0.14713731408119202,-1.645789384841919,-0.3932664692401886,0.21344704926013947,-0.2262546271085739,1.3906936645507812,1.2502527236938477,-1.8673160076141357,1.4302036762237549,-0.38463717699050903,3.1459286212921143,2.592770576477051,2.7141170501708984,1.7206215858459473,-0.254597932100296,0.08853600919246674,0.5446722507476807,-1.540218710899353,0.631365954875946,0.6449835896492004,-1.7046161890029907,0.827869713306427,1.0190151929855347,-0.17432191967964172,1.2357866764068604,1.4040271043777466,0.01728861592710018,0.9723564386367798,-0.9273874163627625,-2.049819231033325,0.5417112708091736,-0.15818624198436737,0.3782133460044861]

========
====

.*Step 22:* Click on the icon for "Attention weights" as shown below
[%collapsible]
====
A small box will open with a heat map of attention weights calculated when the product prediction was derived.  

image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/c35e493e-7c15-47bf-adf6-7a42cc101bc7/ascreenshot.jpeg?tl_px=844,0&br_px=1920,600&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=953,48[Screenshot of: Click this icon.]

TIP: Right-click on the heat map and select "Open image in new tab" for a higher resolution view.

[NOTE]
========
The attention weight heat map is derived from the attention weights calculated while RXN is generating predictions. Attention weights reflect the molecular interactions in the reaction that were most critical when predicting the product (Y-axis of the heat map) from the reactants (X-axis of the heat map).

The following article provides a simple overview of attention in machine learning models: link:https://medium.com/analytics-vidhya/understanding-attention-in-transformers-models-57bada0cce3e#:~:text=Steps%20to%20calculating%20Attention&text=Take%20the%20query%20vector%20for,attention%20score%20or%20attention%20weight%20.[Understanding Attention In Transformers Models]
 
========
====

.*Step 23:* Click the "X" in the upper right to return to the RXN for Chemistry Home page 
[%collapsible]
====
image:https://ajeuwbhvhr.cloudimg.io/colony-recorder.s3.amazonaws.com/files/2023-10-12/a350be11-00b9-433f-a439-526d6fee12a3/ascreenshot.jpeg?tl_px=844,0&br_px=1920,600&force_format=png&wat_scale=95&wat=1&wat_opacity=0.7&wat_gravity=northwest&wat_url=https://colony-recorder.s3.us-west-1.amazonaws.com/images/watermarks/FB923C_standard.png&wat_pad=1007,-11[Screenshot of: Click this icon.]
====

.*Step 24:* Tutorial completed 
[%collapsible]
====
*This completes the Predict product tutorial for RXN for Chemistry.*

In this tutorial, we:

* Executed a product prediction 
* Viewed the results in a Project
* Viewed the details of the predicted product reactions
* Viewed the TreeMAP, fingerprint, and attention heat map of the predicted product reactions
==== 

include::rxn-footer.adoc[]

=======
